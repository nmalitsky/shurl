<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE"/>
    <link href="http://www.xiag.ch/files/css/testtask-styles.css?data=26.07.2012" rel="stylesheet">
    <title>URL shortener</title>
    <script type="text/javascript">
        document._getElementById = function (id) {
            var elem = document.getElementById(id);
            if (!elem) {
                elem = document.getElementsByName(id);
                elem = elem ? elem[0] : null;
            }
            return elem;
        };
        elemId = document._getElementById;

        var XMLHttpRequest = XMLHttpRequest || window.ActiveXObject && function () {
                    return new ActiveXObject('Msxml2.XMLHTTP');
                };

        function getShortUrl() {
            if (elemId('url').value == '') {
                alert('URL can`t be empty');
                return;
            }

            elemId('result').href = '';
            elemId('result').innerHTML = '';

            var xhr = new XMLHttpRequest();
            xhr.open('GET', window.location.protocol + '//' + window.location.host + '/add/?url=' + elemId('url').value);
            xhr.onreadystatechange = function () {
                try {
                    if (xhr.readyState == 4) {
                        var json = JSON.parse(xhr.responseText);
                        elemId('result').href = window.location.protocol + '//' + window.location.host + '/' + json._shortUrl;
                        elemId('result').innerHTML = window.location.protocol + '//' + window.location.host + '/' + json._shortUrl;
                    }
                } catch (e) {
                    console.log(e.message)
                }
            };
            xhr.send();
        }
    </script>
</head>
<body>
<div class="content">
    <header>URL shortener</header>
    <form onsubmit="getShortUrl(); return false;" method="post">
        <table>
            <tr>
                <th>Long URL</th>
                <th>Short URL</th>
            </tr>
            <tr>
                <td>
                    <input type="url" name="url">
                    <input type="button" value="Do!" onclick="getShortUrl()">
                </td>
                <td>
                    <a id="result" target="_blank"></a>
                </td>
            </tr>
        </table>
    </form>
</div>
</body>
</html>
